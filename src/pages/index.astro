---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import headSculpture from '../image/head_sculpture.jpg';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const postCount = posts.length;
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			main {
				max-width: 1400px;
				margin: 0 auto;
				padding: 2em 1em;
				display: grid;
				grid-template-columns: 220px 1fr;
				gap: 2em;
			}
			
			/* å·¦ä¾§ä»‹ç»æ¡† */
			.profile-card {
				background: white;
				border-radius: 12px;
				padding: 1.5em;
				box-shadow: 0 2px 8px rgba(var(--gray), 10%);
				height: fit-content;
				position: sticky;
				top: 100px;
			}
			
			.avatar {
				width: 120px;
				height: 120px;
				border-radius: 50%;
				margin: 0 auto 1em;
				overflow: hidden;
				display: flex;
				align-items: center;
				justify-content: center;
			}
			
			.avatar img {
				width: 100%;
				height: 100%;
				object-fit: cover;
				image-rendering: -webkit-optimize-contrast;
				image-rendering: crisp-edges;
			}
			
			.profile-name {
				text-align: center;
				font-size: 1.2em;
				font-weight: 600;
				color: rgb(var(--black));
				margin-bottom: 0.5em;
			}
			
			.profile-tagline {
				text-align: center;
				color: rgb(var(--gray));
				font-size: 0.85em;
				margin-bottom: 1em;
				padding-bottom: 1em;
				border-bottom: 1px solid rgba(var(--gray-light), 0.8);
			}
			
			.stats {
				display: flex;
				justify-content: center;
				margin-bottom: 0;
			}
			
			.stat-item {
				text-align: center;
			}
			
			.stat-icon {
				font-size: 1.3em;
				margin-bottom: 0.3em;
			}
			
			.stat-number {
				font-size: 1em;
				font-weight: 600;
				color: rgb(var(--black));
			}
			
			/* å³ä¾§åšå®¢æ–‡ç« åˆ—è¡¨ */
			.blog-section {
				min-width: 0;
			}
			
			.search-container {
				margin-bottom: 1.5em;
			}
			
			.search-box {
				position: relative;
				width: 100%;
			}
			
			.search-input {
				width: 100%;
				padding: 0.8em 1em 0.8em 2.5em;
				border: 2px solid rgba(var(--gray-light), 0.8);
				border-radius: 8px;
				font-size: 1em;
				background: white;
				color: rgb(var(--black));
				transition: all 0.2s ease;
				box-sizing: border-box;
			}
			
			.search-input:focus {
				outline: none;
				border-color: var(--accent);
				box-shadow: 0 0 0 3px rgba(35, 55, 255, 0.1);
			}
			
			.search-icon {
				position: absolute;
				left: 0.8em;
				top: 50%;
				transform: translateY(-50%);
				width: 20px;
				height: 20px;
				color: rgb(var(--gray));
				pointer-events: none;
			}
			
			.posts-list {
				display: flex;
				flex-direction: column;
				gap: 1.5rem;
				list-style-type: none;
				margin: 0;
				padding: 0;
			}
			
			.post-item.hidden {
				display: none;
			}
			
			.no-results {
				text-align: center;
				padding: 3em 1em;
				color: rgb(var(--gray));
				display: none;
			}
			
			.no-results.show {
				display: block;
			}
			
			.post-item {
				background: white;
				border-radius: 12px;
				padding: 1.5em;
				box-shadow: 0 2px 8px rgba(var(--gray), 10%);
				transition: all 0.2s ease;
			}
			
			.post-item:hover {
				box-shadow: 0 4px 16px rgba(var(--gray), 20%);
				transform: translateY(-2px);
			}
			
			.post-item a {
				text-decoration: none;
				color: inherit;
				display: block;
			}
			
			.post-title {
				margin: 0 0 0.5em 0;
				color: rgb(var(--black));
				font-size: 1.3em;
				line-height: 1.3;
			}
			
			.post-item:hover .post-title {
				color: var(--accent);
			}
			
			.post-description {
				color: rgb(var(--gray));
				font-size: 0.9em;
				margin: 0.5em 0;
				line-height: 1.6;
			}
			
			.post-meta {
				display: flex;
				align-items: center;
				gap: 1em;
				margin-top: 1em;
				color: rgb(var(--gray));
				font-size: 0.85em;
			}
			
			@media (max-width: 1024px) {
				main {
					grid-template-columns: 1fr;
					padding: 1em;
				}
				
				.profile-card {
					position: static;
					margin-bottom: 2em;
				}
			}
			
			/* ç§»åŠ¨ç«¯ä¸“ç”¨æ ·å¼ */
			@media (max-width: 768px) {
				main {
					padding: 0.5em;
				}
				
				/* ç§»åŠ¨ç«¯ä»‹ç»æ¡†é‡æ–°è®¾è®¡ */
				.profile-card {
					background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.9));
					padding: 1em;
					margin-bottom: 1.5em;
					border-radius: 16px;
					box-shadow: 0 4px 12px rgba(var(--gray), 15%);
					display: flex;
					align-items: center;
					gap: 1em;
					position: relative;
				}
				
				.profile-card .avatar {
					width: 80px;
					height: 80px;
					margin: 0;
					flex-shrink: 0;
				}
				
				.profile-card .profile-name {
					font-size: 1.1em;
					margin-bottom: 0.3em;
					text-align: left;
				}
				
				.profile-card .profile-tagline {
					font-size: 0.8em;
					margin-bottom: 0;
					padding-bottom: 0;
					border-bottom: none;
					text-align: left;
				}
				
				.profile-card .stats {
					position: absolute;
					right: 1em;
					top: 50%;
					transform: translateY(-50%);
					margin: 0;
				}
				
				.stat-icon {
					font-size: 1.1em;
				}
				
				.stat-number {
					font-size: 0.9em;
				}
				
				/* ç§»åŠ¨ç«¯æœç´¢æ¡† */
				.search-input {
					font-size: 16px; /* é˜²æ­¢iOSç¼©æ”¾ */
					padding: 0.7em 1em 0.7em 2.3em;
				}
				
				.search-icon {
					left: 0.7em;
					width: 18px;
					height: 18px;
				}
				
				/* ç§»åŠ¨ç«¯æ–‡ç« å¡ç‰‡ */
				.post-item {
					padding: 1em;
					margin-bottom: 0.5em;
				}
				
				.post-title {
					font-size: 1.1em;
				}
				
				.post-description {
					font-size: 0.85em;
				}
				
				.post-meta {
					font-size: 0.8em;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<!-- å·¦ä¾§ä»‹ç»æ¡† -->
			<aside class="profile-card">
				<div class="avatar">
					<Image src={headSculpture} alt="Avatar" width={240} height={240} quality={100} />
				</div>
				<div class="profile-name">Jack Yue</div>
				<div class="profile-tagline">æ¬¢è¿è®¿é—®æˆ‘çš„åšå®¢ ~ </div>
				
				<div class="stats">
					<div class="stat-item">
						<div class="stat-icon">ğŸ“</div>
						<div class="stat-number">{postCount}</div>
					</div>
				</div>
			</aside>
			
			<!-- å³ä¾§åšå®¢æ–‡ç« åˆ—è¡¨ -->
			<section class="blog-section">
				<div class="search-container">
					<div class="search-box">
						<svg class="search-icon" viewBox="0 0 16 16" fill="currentColor">
							<path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
						</svg>
						<input
							type="text"
							class="search-input"
							placeholder="æœç´¢æ–‡ç« ..."
							id="search-input"
						/>
					</div>
				</div>
				<div class="no-results" id="no-results">
					æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–‡ç« 
				</div>
				<ul class="posts-list" id="posts-list">
					{
						posts.map((post) => (
							<li 
								class="post-item"
								data-title={post.data.title.toLowerCase()}
								data-description={(post.data.description || '').toLowerCase()}
							>
								<a href={`/blog/${post.id}/`}>
									<h3 class="post-title">{post.data.title}</h3>
									{post.data.description && (
										<p class="post-description">{post.data.description}</p>
									)}
									<div class="post-meta">
										<span>
											<FormattedDate date={post.data.pubDate} />
										</span>
									</div>
								</a>
							</li>
						))
					}
				</ul>
			</section>
		</main>
		<Footer />
		<script>
			const searchInput = document.getElementById('search-input') as HTMLInputElement | null;
			const postsList = document.getElementById('posts-list');
			const noResults = document.getElementById('no-results');
			
			if (searchInput && postsList && noResults) {
				const postItems = postsList.querySelectorAll('.post-item');

				function performSearch() {
					if (!searchInput || !noResults) return;
					
					const searchTerm = searchInput.value.toLowerCase().trim();
					let visibleCount = 0;

					postItems.forEach((item) => {
						const title = item.getAttribute('data-title') || '';
						const description = item.getAttribute('data-description') || '';
						
						if (searchTerm === '' || title.includes(searchTerm) || description.includes(searchTerm)) {
							item.classList.remove('hidden');
							visibleCount++;
						} else {
							item.classList.add('hidden');
						}
					});

					// æ˜¾ç¤º/éšè—"æ²¡æœ‰ç»“æœ"æç¤º
					if (visibleCount === 0 && searchTerm !== '') {
						noResults.classList.add('show');
					} else {
						noResults.classList.remove('show');
					}
				}

				// ç›‘å¬è¾“å…¥äº‹ä»¶
				searchInput.addEventListener('input', performSearch);
				
				// ç›‘å¬å›è½¦é”®ï¼Œé˜²æ­¢è¡¨å•æäº¤
				searchInput.addEventListener('keydown', (e) => {
					if (e.key === 'Enter') {
						e.preventDefault();
					}
				});
			}
		</script>
	</body>
</html>
